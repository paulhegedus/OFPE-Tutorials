<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Edit/Run Google Earth Engine</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">OFPE Framework</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Diagrams
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ofpe_overview.html">OFPE Overview</a>
    </li>
    <li>
      <a href="db_creation.html">Database Creation</a>
    </li>
    <li>
      <a href="dat_import.html">Data Import</a>
    </li>
    <li>
      <a href="data_agg.html">Data Aggregation</a>
    </li>
    <li>
      <a href="sim_anal.html">Simulation/Analysis</a>
    </li>
    <li>
      <a href="rx_gen.html">Prescription Generation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Set Up</li>
    <li>
      <a href="postgres_setup.html">PostgreSQL Set Up</a>
    </li>
    <li>
      <a href="create_shp_qgis.html">Create Shapefile</a>
    </li>
    <li>
      <a href="gee_setup.html">Google Earth Engine Set Up</a>
    </li>
    <li>
      <a href="gd_setup.html">Google Drive Set Up</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Annual Tasks</li>
    <li>
      <a href="run_gee.html">Edit/Run Google Earth Engine</a>
    </li>
  </ul>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Edit/Run Google Earth Engine</h1>

</div>


<p>Remote sensing data is collected from Google Earth Engine and includes data temporally variable data such as weather and static data such as topogrophy. The user is responsible for running the Google Earth Engine Javascript code to download data for each year required. See this <a href="gee_setup.html">tutorial</a> for adding farm boundaries to GEE as asset and this <a href="gd_setup.html">tutorial</a> for setting up Google Drive to receive your data from Google Earth Engine. See the diagrams on this <a href="dat_import.html">page</a> for an overview of the Google Earth Engine data download.</p>
<p>Besides the section on creating the Google Earth Engine Javascript, the tutorial below outlines a workflow that should be repeated on an annual basis to download data for the past and current year (up to March 30th). Any parameters can be turned off, any selection of farms can be selected, and any years can be selected by the user.</p>
<div id="description" class="section level3">
<h3>Description</h3>
<p>This code is for looping through a sequence of specified years for all farms and downloading all GEE variables for a specified year. The code takes the user selected years and downloads all data for that year up until 03/30. It also downloads the full year’s worth of data for the previous year. This means that the least recent year of data in the database will be 1 minus the least recent year specified in the user selection. The user can select a sequence of years in order, or a string of years to download data for. This code was developed for efficiently downloading previous years data from GEE. However, because the user can specify specific years, this code can be used as the annual run once per year and will download all the variables needed for all the farms for the current year (up to mar) and previous year (full year) when 1 year is specified.In the database these are distinguished by a column labeled ‘mar’ or ‘full’ for up to march and full year, respectively. Note that water years are from November 1 to October 31. User also has control over what variables to collect so not all vars are collected if not desired.</p>
<p>Precipitation and growing degree day information is collected from GRIDMET by the Idaho EPSCoR project and is 4 km resolution with data available from 1979. It is also collected from Daymet V3, by the NASA ORNL group, which is preferred due to it’s 1km reolution. The surfaces data is collected from the USGS National Elevation Dataset at a 10 m scale from prior to 1999. The vegetation index data is collected from different sources based on the date requested. All data 2018 or later are 10 m resolution filtered top of atmosphere measures from the EU’s Copernicus Sentinel 2. Prior to 2018 cy and 2016 py, data is collected from Landsat 5 if before 2012, Landsat 7 for 2012/2013, and Landsat 8 for after. Landsat 8 is collected until present to gap fill. S2 provides NDRE and CLRE (should be CIRE) bands for calculating. For Canadian farms the data is collected from NASA ORNL DaymetV3 at a 1km scale exclusively because the USGS NED is not available. These are estimates. Elevation data is from the National Elevaiton dataset at 10m scale for the USA and from the Canadian Digital Elevation Model at a 20m scale for elevation and SRTM from NASA at a 30m scale for slope, aspect, tpi.</p>
</div>
<div id="naming-convention" class="section level3">
<h3>Naming Convention</h3>
<p>The naming convention for these files are important for the import of the data to the OFPE database. Again, you need to have a Google Drive folder set up with a folder called ‘GEE_Surfaces’ to receive these files. See this <a href="gd_setup.html">tutorial</a> if not set up already. The import code is relatively rigid because this GEE data is under our control and we can nameand format how we like. The import code gathers information about the data from the name of the file so the naming convention becomes important. It would be easiest if these were not changed.</p>
<p><strong>GENERAL FORMAT:</strong> <em>farmername</em>_<em>scale</em>_<em>datasource</em>_<em>measure</em>_<em>current/previous year</em>_<em>year</em>_<em>loy</em>.</p>
<ul>
<li><em>e.g.</em> “<em>farmer</em>_<em>farmname</em>_clre_20m_2013_mar” = 20 m resolution clre data from 2013 up until 03/30 for <em>farmer</em>’s fields at <em>farmname</em></li>
<li><em>or</em> “<em>farmer</em>_<em>farmname</em>_4km_gdd_prevYr_2018” = 4km gdd data from 2018 for <em>farmer</em>’s fields at <em>farmname</em></li>
</ul>
<p><strong>IMPORTANT:</strong> If you change the name of any variable in the filenames, or if you use a new scale, check the GEE import script source code for compatibility.</p>
</div>
<div id="tutorial" class="section level3">
<h3>Tutorial</h3>
<p>This tutorial assumes that the user has already set up a <a href="https://earthengine.google.com/">Google Earth Engine</a> and <a href="https://www.google.com/drive/">Google Drive</a> account. Additionally, it assumes the user has followed the setup instructions in this <a href="create_shp_qgis.html">tutorial</a>, this <a href="gee_setup.html">tutorial</a>, and this <a href="gd_setup.html">tutorial</a>.</p>
</div>
<div id="script-creation" class="section level3">
<h3>Script Creation</h3>
<p>This section of the tutorial is for gathering the OFPE script for gathering all relevant Google Earth Engine (GEE) data.</p>
<p><strong>1.</strong> Download the Javascript code developed for the OFPE project and open the file. This code can also be found <a href="https://github.com/paulhegedus/Google_Earth_Engine/blob/master/OFPE/ogpe_gee_javascript.txt">here</a>.</p>
<a href="data:text/plain;base64,Ly8gU2NyaXB0IGZvciBjb2xsZWN0aW5nIGFsbCBmYXJtcyBHRUUgdmFyaWFibGVzIGZvciBhIHNwZWNpZmllZCBzZXQvc2VxdWVuY2Ugb2YgeWVhcihzKQovLyBQYXVsIEhlZ2VkdXMgLSAyMDE5MTEwOQovLyBUaGlzIGNvZGUgcnVucyBpbiBHb29nbGUgRWFydGggRW5naW5lIENvZGUgRWRpdG9yLiBGb2xsb3cgdGhlIGxpbmtzIGJlbG93IHRvIHNldCB1cCBhbmQgcHJlcGFyZSAKLy8gR29vZ2xlIERyaXZlLgovLyBodHRwczovL3BhdWxoZWdlZHVzLmdpdGh1Yi5pby9PRlBFLVdlYnNpdGUvZ2VlX3NldHVwLmh0bWwKLy8gaHR0cHM6Ly9wYXVsaGVnZWR1cy5naXRodWIuaW8vT0ZQRS1XZWJzaXRlL2dkX3NldHVwLmh0bWwKLy8gTW9zdCBpbXBvcnRhbnRseSwgdGhlIGxpbmsgYmVsb3csIGZvciB1c2luZyB0aGlzIGNvZGU7Ci8vIGh0dHBzOi8vcGF1bGhlZ2VkdXMuZ2l0aHViLmlvL09GUEUtV2Vic2l0ZS9ydW5fZ2VlLmh0bWwKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBBc3NldHMgKENPUFkgQU5EIFBBU1RFLCBVTkNPTU1FTlQsICYgSU1QT1JUKQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy92YXIgZ3JpZG1ldCA9IGVlLkltYWdlQ29sbGVjdGlvbigiSURBSE9fRVBTQ09SL0dSSURNRVQiKSwKLy9uZWQgPSBlZS5JbWFnZSgiVVNHUy9ORUQiKSwKLy9jZGVtID0gZWUuSW1hZ2VDb2xsZWN0aW9uKCJOUkNhbi9DREVNIiksCi8vc3J0bSA9IGVlLkltYWdlKCdVU0dTL1NSVE1HTDFfMDAzJyksCi8vTDdzciA9IGVlLkltYWdlQ29sbGVjdGlvbigiTEFORFNBVC9MRTA3L0MwMS9UMV9TUiIpLAovL3MydG9hID0gZWUuSW1hZ2VDb2xsZWN0aW9uKCJDT1BFUk5JQ1VTL1MyIiksCi8vTDVzciA9IGVlLkltYWdlQ29sbGVjdGlvbigiTEFORFNBVC9MVDA1L0MwMS9UMV9TUiIpLAovL0w4c3IgPSBlZS5JbWFnZUNvbGxlY3Rpb24oIkxBTkRTQVQvTEMwOC9DMDEvVDFfU1IiKSwKLy9zbWFwID0gZWUuSW1hZ2VDb2xsZWN0aW9uKCdOQVNBX1VTREEvSFNML1NNQVBfc29pbF9tb2lzdHVyZScpLAovL2RheW1ldCA9IGVlLkltYWdlQ29sbGVjdGlvbignTkFTQS9PUk5ML0RBWU1FVF9WMycpOyAvLyAKCi8vIE5vdGUgdGhhdCBub3QgYWxsIG9mIHRoZSBzb3VyY2VzIGFib3ZlIGFyZSB1c2VkLCBidXQgYXJlIG9wdGlvbnMuCgovLyBBZ2Fpbiwgc2VlIGh0dHBzOi8vcGF1bGhlZ2VkdXMuZ2l0aHViLmlvL09GUEUtV2Vic2l0ZS9ydW5fZ2VlLmh0bWwgZm9yIHRoZSBkZXNjcmlwdGlvbiBhbmQgdHV0b3JpYWwgb24KLy8gaG93IHRvIHVzZSB0aGlzIGNvZGUuCgovLyBUaGlzIGNvZGUgaXMgZm9yIGxvb3BpbmcgdGhyb3VnaCBhIHNlcXVlbmNlIG9mIHNwZWNpZmllZCB5ZWFycyBmb3IgYWxsIGZhcm1zIAovLyBhbmQgZG93bmxvYWRpbmcgYWxsIEdFRSB2YXJpYWJsZXMgZm9yIGEgc3BlY2lmaWVkIHllYXIuIAoKLy8gUHJlY2lwaXRhdGlvbiBhbmQgZ3Jvd2luZyBkZWdyZWUgZGF5IGluZm9ybWF0aW9uIGlzIGNvbGxlY3RlZCBmcm9tIEdSSURNRVQgYnkgdGhlIElkYWhvIEVQU0NvUiBwcm9qZWN0Ci8vIGFuZCBpcyA0IGttIHJlc29sdXRpb24gd2l0aCBkYXRhIGF2YWlsYWJsZSBmcm9tIDE5NzkuIEl0IGlzIGFsc28gY29sbGVjdGVkIGZyb20gRGF5bWV0IFYzLCBieSB0aGUgCi8vIE5BU0EgT1JOTCBncm91cCwgd2hpY2ggaXMgcHJlZmVycmVkIGR1ZSB0byBpdCdzIDFrbSByZW9sdXRpb24uIFRoZSBzdXJmYWNlcyBkYXRhIGlzIGNvbGxlY3RlZCBmcm9tIHRoZSBVU0dTCi8vIE5hdGlvbmFsIEVsZXZhdGlvbiBEYXRhc2V0IGF0IGEgMTAgbSBzY2FsZSBmcm9tIHByaW9yIHRvIDE5OTkuIFRoZSB2ZWdldGF0aW9uIGluZGV4IGRhdGEgaXMgY29sbGVjdGVkCi8vIGZyb20gZGlmZmVyZW50IHNvdXJjZXMgYmFzZWQgb24gdGhlIGRhdGUgcmVxdWVzdGVkLiBBbGwgZGF0YSAyMDE4IG9yIGxhdGVyIGFyZSAxMCBtIHJlc29sdXRpb24gZmlsdGVyZWQgCi8vIHRvcCBvZiBhdG1vc3BoZXJlIG1lYXN1cmVzIGZyb20gdGhlIEVVJ3MgQ29wZXJuaWN1cyBTZW50aW5lbCAyLiBQcmlvciB0byAyMDE4IGN5IGFuZCAyMDE2IHB5LCBkYXRhCi8vIGlzIGNvbGxlY3RlZCBmcm9tIExhbmRzYXQgNSBpZiBiZWZvcmUgMjAxMiwgTGFuZHNhdCA3IGZvciAyMDEyLzIwMTMsIGFuZCBMYW5kc2F0IDggZm9yIGFmdGVyLiAKLy8gTGFuZHNhdCA4IGlzIGNvbGxlY3RlZCB1bnRpbCBwcmVzZW50IHRvIGdhcCBmaWxsLiBTMiBwcm92aWRlcyBORFJFIGFuZCBDTFJFIChzaG91bGQgYmUgQ0lSRSkgYmFuZHMgZm9yIGNhbGN1bGF0aW5nLiAKLy8gRm9yIENhbmFkaWFuIGZhcm1zIHRoZSBkYXRhIGlzIGNvbGxlY3RlZCBmcm9tIE5BU0EgT1JOTCBEYXltZXRWMyBhdCBhIDFrbSBzY2FsZSBleGNsdXNpdmVseSBiZWNhdXNlIHRoZSAKLy8gVVNHUyBORUQgaXMgbm90IGF2YWlsYWJsZS4gVGhlc2UgYXJlIGVzdGltYXRlcy4gRWxldmF0aW9uIGRhdGEgaXMgZnJvbSB0aGUgTmF0aW9uYWwgRWxldmFpdG9uIGRhdGFzZXQgYXQKLy8gMTBtIHNjYWxlIGZvciB0aGUgVVNBIGFuZCBmcm9tIHRoZSBDYW5hZGlhbiBEaWdpdGFsIEVsZXZhdGlvbiBNb2RlbCBhdCBhIDIwbSBzY2FsZSBmb3IgZWxldmF0aW9uIGFuZCBTUlRNIGZyb20gTkFTQQovLyBhdCBhIDMwbSBzY2FsZSBmb3Igc2xvcGUsIGFzcGVjdCwgdHBpLgoKLy8gTkFNSU5HIENPTlZFTlRJT04KLy8gVGhlIG5hbWluZyBjb252ZW50aW9uIGZvciB0aGVzZSBmaWxlcyBhcmUgaW1wb3J0YW50IGZvciB0aGUgaW1wb3J0IG9mIHRoZSBkYXRhIHRvIHRoZSBPRlBFIGRhdGFiYXNlLiAKLy8gQWdhaW4sIHlvdSBuZWVkIHRvIGhhdmUgYSBHb29nbGUgRHJpdmUgZm9sZGVyIHNldCB1cCB3aXRoIGEgZm9sZGVyIGNhbGxlZCAnR0VFX1N1cmZhY2VzJyB0byByZWNlaXZlIHRoZXNlIGZpbGVzLgovLyBTZWUgdGhpcyBbdHV0b3JpYWxdKGdkX3NldHVwLmh0bWwpIGlmIG5vdCBzZXQgdXAgYWxyZWFkeS4gVGhlIGltcG9ydCBjb2RlIGlzIHJlbGF0aXZlbHkgcmlnaWQgYmVjYXVzZSB0aGlzIAovLyBHRUUgZGF0YSBpcyB1bmRlciBvdXIgY29udHJvbCBhbmQgd2UgY2FuIG5hbWVhbmQgZm9ybWF0IGhvdyB3ZSBsaWtlLiBUaGUgaW1wb3J0IGNvZGUgZ2F0aGVycyBpbmZvcm1hdGlvbiBhYm91dCAKLy8gdGhlIGRhdGEgZnJvbSB0aGUgbmFtZSBvZiB0aGUgZmlsZSBzbyB0aGUgbmFtaW5nIGNvbnZlbnRpb24gYmVjb21lcyBpbXBvcnRhbnQuIEl0IHdvdWxkIGJlIGVhc2llc3QgaWYgdGhlc2UKLy8gd2VyZSBub3QgY2hhbmdlZC4KCi8vIEdFTkVSQUwgRk9STUFUOiA8ZmFybWVybmFtZT5fPHNjYWxlPl88ZGF0YXNvdXJjZT5fPG1lYXN1cmU+XzxjdXJyZW50L3ByZXZpb3VzIHllYXI+Xzx5ZWFyPl88bG95Pi4gCi8vIGUuZy4g4oCcPGZhcm1lcj5fPGZhcm1uYW1lPl9jbHJlXzIwbV8yMDEzX21hcuKAnSA9IAovLyAyMCBtIHJlc29sdXRpb24gY2xyZSBkYXRhIGZyb20gMjAxMyB1cCB1bnRpbCAwMy8zMCBmb3IgPGZhcm1lcj4ncyBmaWVsZHMgYXQgPGZhcm1uYW1lPgovLyAqb3IqICDigJw8ZmFybWVyPl88ZmFybW5hbWU+XzRrbV9nZGRfcHJldllyXzIwMTjigJ0gPSAKLy8gNGttIGdkZCBkYXRhIGZyb20gMjAxOCBmb3IgPGZhcm1lcj4ncyBmaWVsZHMgYXQgPGZhcm1uYW1lPgoKLy8gSU1QT1JUQU5UOiBJZiB5b3UgY2hhbmdlIHRoZSBuYW1lIG9mIGFueSB2YXJpYWJsZSBpbiB0aGUgZmlsZW5hbWVzLCBvciBpZiB5b3UgdXNlIGEgbmV3IHNjYWxlLCAKLy8gY2hlY2sgdGhlIEdFRSBpbXBvcnQgc2NyaXB0IHNvdXJjZSBjb2RlIGZvciBjb21wYXRpYmlsaXR5LgoKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBVU0VSIElOUFVUUwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gU2VsZWN0IHZhcnMgdG8gY29sbGVjdCAxPXllcywgMD1ubwp2YXIgcHJlY0NZID0gMTsgCnZhciBwcmVjUFkgPSAxOyAKdmFyIGdkZENZID0gMTsgCnZhciBnZGRQWSA9IDE7IAp2YXIgYXNwZWN0ID0gMTsgCnZhciBzbG9wZUkgPSAxOyAKdmFyIGVsZXYgPSAxOyAKdmFyIHRwaUkgPSAxOyAKdmFyIG5kdmlDWSA9IDE7IAp2YXIgbmR2aVBZID0gMTsgCnZhciBuZHJlQ1kgPSAxOyAKdmFyIG5kcmVQWSA9IDE7IAp2YXIgY2xyZUNZID0gMTsgCnZhciBjbHJlUFkgPSAxOyAKdmFyIHNtYXBDWSA9IDE7CnZhciBzbWFwUFkgPSAxOwoKLy8gU3RyaW5nIG9yIHNlcXVlbmNlIG9mIHllYXJzIHRvIGdldCBkYXRhIGZvcgp2YXIgeWVhcnMgPSBbJzIwMDAnLCcyMDAxJywnMjAwMicsJzIwMDMnLCcyMDA0JywnMjAwNScsJzIwMDYnLCcyMDA3JywnMjAwOCcsJzIwMDknLCcyMDEwJywnMjAxMScsJzIwMTInLCcyMDEzJywnMjAxNCcsJzIwMTUnLCcyMDE2JywnMjAxNycsJzIwMTgnLCcyMDE5JywnMjAyMCddOwoKLy8gU3RyaW5nIG9mIGZhcm1zIChhc3NldHMgdGhhdCBhcmUgaW5nZXN0ZWQgYWxyZWFkeSkgdG8gbG9vcCBvdmVyIChORUVEIHRvIGFkZCBvdGhlcnMgd2hlbiB5b3UgaGF2ZSB0aGVtKQp2YXIgZmFybXMgPSBbJzxmYXJtZXI+XzxmYXJtbmFtZT4nLCc8ZmFybWVyPl88ZmFybW5hbWU+JywnPGZhcm1lcj5fPGZhcm1uYW1lPiddOyAvLwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZ1bmN0aW9ucwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQ2FsY3VsYXRlIEdERCBGdW5jdGlvbnMKdmFyIGdkZFYzID0gZnVuY3Rpb24oaW1hZ2UpewogIHZhciBkYXlzID0gaW1hZ2UuZXhwcmVzc2lvbignKHRtYXggKyB0bWluKS8yIC0gMCcsIHsKICAgICd0bWluJzogaW1hZ2Uuc2VsZWN0KCd0bWluJyksCiAgICAndG1heCc6IGltYWdlLnNlbGVjdCgndG1heCcpCiAgfSk7CiAgcmV0dXJuIGRheXMucmVuYW1lKFsnZ2RkJ10pLnVwZGF0ZU1hc2soZGF5cy5ndCgwKSk7Cn07CnZhciBnZGQgPSBmdW5jdGlvbihpbWFnZSl7CiAgdmFyIGRheXMgPSBpbWFnZS5leHByZXNzaW9uKCcodG1tbiArIHRtbXgpLzIgLSAoMCArIDI3My4xNSknLCB7CiAgICAndG1tbic6IGltYWdlLnNlbGVjdCgndG1tbicpLAogICAgJ3RtbXgnOiBpbWFnZS5zZWxlY3QoJ3RtbXgnKQogIH0pOwogIHJldHVybiBkYXlzLnJlbmFtZShbJ2dkZCddKS51cGRhdGVNYXNrKGRheXMuZ3QoMCkpOwp9OwovLyBEZWZpbmUgYSBmdW5jdGlvbiB0byBjb252ZXJ0IGZyb20gZGVncmVlcyB0byByYWRpYW5zIGZvciBhc3BlY3QKdmFyIHJhZGlhbnMgPSBmdW5jdGlvbihpbWcpIHsKICByZXR1cm4gaW1nLnRvRmxvYXQoKS5tdWx0aXBseShNYXRoLlBJKS5kaXZpZGUoMTgwKTsKfTsKLy8gRnVuY3Rpb24gdG8gbWFzayBjbG91ZHMgdXNpbmcgdGhlIFNlbnRpbmVsLTIgUUEgYmFuZC4KdmFyIG1hc2tTMmNsb3VkcyA9IGZ1bmN0aW9uKGltYWdlKSB7CiAgdmFyIHFhID0gaW1hZ2Uuc2VsZWN0KCdRQTYwJyk7CiAgLy8gQml0cyAxMCBhbmQgMTEgYXJlIGNsb3VkcyBhbmQgY2lycnVzLCByZXNwZWN0aXZlbHkuCiAgdmFyIGNsb3VkQml0TWFzayA9IDEgPDwgMTA7CiAgdmFyIGNpcnJ1c0JpdE1hc2sgPSAxIDw8IDExOwogIC8vIEJvdGggZmxhZ3Mgc2hvdWxkIGJlIHNldCB0byB6ZXJvLCBpbmRpY2F0aW5nIGNsZWFyIGNvbmRpdGlvbnMuCiAgdmFyIG1hc2sgPSBxYS5iaXR3aXNlQW5kKGNsb3VkQml0TWFzaykuZXEoMCkuYW5kKAogICAgcWEuYml0d2lzZUFuZChjaXJydXNCaXRNYXNrKS5lcSgwKSk7CiAgLy8gUmV0dXJuIHRoZSBtYXNrZWQgYW5kIHNjYWxlZCBkYXRhLCB3aXRob3V0IHRoZSBRQSBiYW5kcy4KICByZXR1cm4gaW1hZ2UudXBkYXRlTWFzayhtYXNrKS5kaXZpZGUoMTAwMDApCiAgICAuc2VsZWN0KCJCLioiKQogICAgLmNvcHlQcm9wZXJ0aWVzKGltYWdlLCBbInN5c3RlbTp0aW1lX3N0YXJ0Il0pOwp9OwovLyBGdW5jdGlvbiB0byBtYXNrIGNsb3VkcyB1c2luZyB0aGUgTGFuZHNhdCA4IGJhbmRzCnZhciBtYXNrTDhzciA9IGZ1bmN0aW9uKGltYWdlKSB7CiAgLy8gQml0cyAzIGFuZCA1IGFyZSBjbG91ZCBzaGFkb3cgYW5kIGNsb3VkLCByZXNwZWN0aXZlbHkuCiAgdmFyIGNsb3VkU2hhZG93Qml0TWFzayA9ICgxIDw8IDMpOwogIHZhciBjbG91ZHNCaXRNYXNrID0gKDEgPDwgNSk7CiAgLy8gR2V0IHRoZSBwaXhlbCBRQSBiYW5kLgogIHZhciBxYSA9IGltYWdlLnNlbGVjdCgncGl4ZWxfcWEnKTsKICAvLyBCb3RoIGZsYWdzIHNob3VsZCBiZSBzZXQgdG8gemVybywgaW5kaWNhdGluZyBjbGVhciBjb25kaXRpb25zLgogIHZhciBtYXNrID0gcWEuYml0d2lzZUFuZChjbG91ZFNoYWRvd0JpdE1hc2spLmVxKDApCiAgICAuYW5kKHFhLmJpdHdpc2VBbmQoY2xvdWRzQml0TWFzaykuZXEoMCkpOwogIHJldHVybiBpbWFnZS51cGRhdGVNYXNrKG1hc2spOwp9OwovLyBjYWxjdWxhdGVzIG5kdmkgQCAzMG0gcmVzb2x1dGlvbiBmcm9tIExhbmRzYXQgNCwgNSwgYW5kIDcgc3VyZmFjZSByZWZsZWN0YW5jZQp2YXIgY2xvdWRNYXNrTDQ1NyA9IGZ1bmN0aW9uKGltYWdlKSB7CiAgdmFyIHFhID0gaW1hZ2Uuc2VsZWN0KCdwaXhlbF9xYScpOwogIC8vIElmIHRoZSBjbG91ZCBiaXQgKDUpIGlzIHNldCBhbmQgdGhlIGNsb3VkIGNvbmZpZGVuY2UgKDcpIGlzIGhpZ2gKICAvLyBvciB0aGUgY2xvdWQgc2hhZG93IGJpdCBpcyBzZXQgKDMpLCB0aGVuIGl0J3MgYSBiYWQgcGl4ZWwuCiAgdmFyIGNsb3VkID0gcWEuYml0d2lzZUFuZCgxIDw8IDUpCiAgICAuYW5kKHFhLmJpdHdpc2VBbmQoMSA8PCA3KSkKICAgIC5vcihxYS5iaXR3aXNlQW5kKDEgPDwgMykpOwogIC8vIFJlbW92ZSBlZGdlIHBpeGVscyB0aGF0IGRvbid0IG9jY3VyIGluIGFsbCBiYW5kcwogIHZhciBtYXNrMiA9IGltYWdlLm1hc2soKS5yZWR1Y2UoZWUuUmVkdWNlci5taW4oKSk7CiAgcmV0dXJuIGltYWdlLnVwZGF0ZU1hc2soY2xvdWQubm90KCkpLnVwZGF0ZU1hc2sobWFzazIpOwp9OwoKLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8vIFNUQVJUIENPREUKLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8vIHN0YXJ0IGxvb3AgdGhyb3VnaCB5ZWFycwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KdmFyIGo9MDsKZm9yKGo7IGogPCB5ZWFycy5sZW5ndGg7IGorKyl7CiAgdmFyIENZID0geWVhcnNbal07CiAgdmFyIFBZID0gQ1kgLSAxOwogIC8vIHN0YXJ0IGZvciBsb29wIHRocm91Z2ggZmFybXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB2YXIgaT0wOyAKICBmb3IoaTsgaSA8IGZhcm1zLmxlbmd0aDsgaSsrKXsKICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gc2V0IHVwIGFzc2V0cwogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICB2YXIgdGFibGUgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbigidXNlcnMvPEdPT0dMRSBEUklWRSBVU0VSTkFNRT4vIiArIGZhcm1zW2ldICsgIl9iYm94Iik7IAogICAgLy8gXklNUE9SVEFOVF46IE1vZGlmeSB0aGlzIHBhdGggYXMgbmVlZGVkLiBGb3IgZXhhbXBsZSwgcmVtb3ZlICJfYmJveCIgaWYgdGhhdCBpcyBub3QgaW4geW91ciBhc3NldCBuYW1lcy4KICAgIHZhciBmYXJtX25hbWUgPSB0YWJsZTsKICAgIHZhciBjdXJyZW50X2Zhcm0gPSBmYXJtc1tpXTsKICAgIC8vTWFwLmFkZExheWVyKGZhcm1fbmFtZSx7fSwgY3VycmVudF9mYXJtICsgJ19iYm94JywgdHJ1ZSk7CiAgICAKICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vIFNUQVJUIENPREUgRk9SIEZBUk1pIFlFQVJqCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ0xJTUFURSBWQVJJQUJMRVMgKFBSRUMsIEdERCkKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDbGltYXRlIHZhcmlhYmxlcyBpbiBOb3J0aCBBbWVyaWNhIGNvbGxlY2V0ZWQgZnJvbSBOQVNBIE9STkwKICAgIC8vIERheW1ldFYzIGRhdGFzZXQgKDFrbSkKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUHJlY2lwaXRhdGlvbgogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQUkVDIENZCiAgICBpZihwcmVjQ1k9PTEpewogICAgICAvL3VzZSBtb250aC1kYXkgb2YgMTEtMDEgYW5kIDAzLTMwIGZvciBwcmVjIHRocnUgbWFyY2ggb2YgY3VycmVudCBncm93IHlyLCAKICAgICAgdmFyIGN1cnJZZWFyID0gQ1k7CiAgICAgIHZhciBzdGFydERhdGUgPSBQWSArICctMTEtMDEnOwogICAgICB2YXIgZW5kRGF0ZSA9ICBDWSArICctMDMtMzAnOwogICAgICAvLyBzZWxlY3QgZm9yIHByZWNpcCBkYXRhCiAgICAgIHZhciBwcmVjaXAgPSBkYXltZXQuc2VsZWN0KCdwcmNwJykKICAgICAgICAuZmlsdGVyRGF0ZShzdGFydERhdGUsIGVuZERhdGUpCiAgICAgICAgLnN1bSgpOwogICAgICAvLyBDbGlwIFByZWNpcCBpbWFnZXMKICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgdmFyIHByZWNpcF9zdW1fY3lfY2xpcHBlZCA9IHByZWNpcC5jbGlwKG1hc2spOwogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUgICAgICAgIAogICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgaW1hZ2U6IHByZWNpcF9zdW1fY3lfY2xpcHBlZCwKICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ18xa21fZGF5bWV0X3ByZWNfY3VycllyXycgKyBjdXJyWWVhciwKICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywgLy8gc2F2ZXMgaXQgYXMgbG9uZyBsYXQgd2dzODQgKHJlcHJvamVjdGVkIGZvciBzcGF0aWFsIGFuYWx5c2lzKQogICAgICAgIHNjYWxlOiAxMCwKICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgfSk7CiAgICB9IC8vIEVORCBQUkVDIENZCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBSRUMgUFkKICAgIGlmKHByZWNQWT09MSl7CiAgICAgIC8vdXNlIDExLTAxIGFuZCAxMC0zMSBmb3IgcHJldiBncm93IHlyCiAgICAgIHZhciBwcmV2WWVhciA9IFBZOwogICAgICB2YXIgc3RhcnREYXRlID0gUFktMSArJy0xMS0wMSc7CiAgICAgIHZhciBlbmREYXRlID0gIFBZICsgJy0xMC0zMSc7CiAgICAgIC8vIHNlbGVjdCBmb3IgcHJlY2lwIGRhdGEKICAgICAgdmFyIHByZWNpcCA9IGRheW1ldC5zZWxlY3QoJ3ByY3AnKQogICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkKICAgICAgICAuc3VtKCk7CiAgICAgIC8vIENsaXAgUHJlY2lwIGltYWdlcwogICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgcHJlY2lwX3N1bV9weV9jbGlwcGVkID0gcHJlY2lwLmNsaXAobWFzayk7CiAgICAgIC8vZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgaW1hZ2U6IHByZWNpcF9zdW1fcHlfY2xpcHBlZCwKICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ18xa21fZGF5bWV0X3ByZWNfcHJldllyXycgKyBwcmV2WWVhciwKICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICBzY2FsZTogMTAsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfSAvLyBFTkQgUFJFQyBQWQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBHcm93aW5nIERlZ3JlZSBEYXlzCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEdERCBDWQogICAgaWYoZ2RkQ1k9PTEpewogICAgICB2YXIgZ3Jvd195ciA9IENZOwogICAgICAvL3VzZSB0aGlzIGJsb2NrIGZvciBnZGQgZnJvbSBqYW4gMSB0byBtYXIgMzAgb2YgY3VycmVudCB5ciAoY3VycmVudCB5ZWFyKQogICAgICB2YXIgZ2RkX2N5ID0gZGF5bWV0IAogICAgICAgIC5maWx0ZXJEYXRlKGdyb3dfeXIudG9TdHJpbmcoKSwgKGdyb3dfeXIgKyAxKS50b1N0cmluZygpKQogICAgICAgIC5maWx0ZXIoZWUuRmlsdGVyLmRheU9mWWVhcigxLCA5MCkpCiAgICAgICAgLm1hcChnZGRWMykKICAgICAgICAuc3VtKCk7CiAgICAgIC8vIENsaXAgR0REIGltYWdlcwogICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgZ2RkX2N5X2NsaXAgPSAgZ2RkX2N5LmNsaXAobWFzayk7IAogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgIGltYWdlOiBnZGRfY3lfY2xpcCwgLy8KICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ18xa21fZGF5bWV0X2dkZF9jdXJyWXJfJyArIGdyb3dfeXIsIAogICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgIHNjYWxlOiAxMCwKICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgfSk7CiAgICB9IC8vIEVORCBDWSBHREQKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gR0REIFBZCiAgICBpZihnZGRQWT09MSl7CiAgICAgIHZhciBncm93X1ByZXZZciA9IFBZOwogICAgICAvLyB1c2UgdGhpcyBibG9jayBmb3IgZ2RkIGZyb20gamFuIDEgdGhydSBqdW4gMzAgb2YgcHJldiBncm93IHlyIChwcmV2IHlyKQogICAgICB2YXIgZ2RkX3B5ID0gZGF5bWV0CiAgICAgICAgLmZpbHRlckRhdGUoZ3Jvd19QcmV2WXIudG9TdHJpbmcoKSwgKGdyb3dfUHJldllyICsgMSkudG9TdHJpbmcoKSkKICAgICAgICAuZmlsdGVyKGVlLkZpbHRlci5kYXlPZlllYXIoMSwgMTgwKSkKICAgICAgICAubWFwKGdkZFYzKQogICAgICAgIC5zdW0oKTsKICAgICAgLy8gQ2xpcCBHREQgaW1hZ2VzCiAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgIHZhciBnZGRfcHlfY2xpcCA9IGdkZF9weS5jbGlwKG1hc2spOyAvLwogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgIGltYWdlOiBnZGRfcHlfY2xpcCwgCiAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfMWttX2RheW1ldF9nZGRfcHJldllyXycgKyBncm93X1ByZXZZciwgCiAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgc2NhbGU6IDEwLAogICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICB9KTsKICAgIH0gLy8gRU5EIFBZIEdERCAgIAogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENsaW1hdGUgdmFyaWFibGVzIGluIHRoZSBVU0EgY29sbGVjZXRlZCBmcm9tIFVvZklkYWhvCiAgICAvLyBHUklETUVUIGRhdGFzZXQgKDRrbSkKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUHJlY2lwaXRhdGlvbgogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQUkVDIENZIAogICAgaWYocHJlY0NZPT0xKXsKICAgICAgLy91c2UgbW9udGgtZGF5IG9mIDExLTAxIGFuZCAwMy0zMCBmb3IgcHJlYyB0aHJ1IG1hcmNoIG9mIGN1cnJlbnQgZ3JvdyB5ciwgCiAgICAgIHZhciBjdXJyWWVhciA9IENZOwogICAgICB2YXIgc3RhcnREYXRlID0gUFkgKyAnLTExLTAxJzsKICAgICAgdmFyIGVuZERhdGUgPSAgQ1kgKyAnLTAzLTMwJzsKICAgICAgLy8gc2VsZWN0IGZvciBwcmVjaXAgZGF0YQogICAgICB2YXIgcHJlY2lwID0gZ3JpZG1ldC5zZWxlY3QoJ3ByJykKICAgICAgICAuZmlsdGVyRGF0ZShzdGFydERhdGUsIGVuZERhdGUpCiAgICAgICAgLnN1bSgpOwogICAgICAvLyBDbGlwIFByZWNpcCBpbWFnZXMKICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgdmFyIHByZWNpcF9zdW1fY3lfY2xpcHBlZCA9IHByZWNpcC5jbGlwKG1hc2spOwogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUgICAgICAgIAogICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgaW1hZ2U6IHByZWNpcF9zdW1fY3lfY2xpcHBlZCwKICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ180a21fZ3JpZG1ldF9wcmVjX2N1cnJZcl8nICsgY3VyclllYXIsCiAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsIC8vIHNhdmVzIGl0IGFzIGxvbmcgbGF0IHdnczg0IChyZXByb2plY3RlZCBmb3Igc3BhdGlhbCBhbmFseXNpcykKICAgICAgICBzY2FsZTogMTAsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfSAvLyBFTkQgUFJFQyBDWQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQUkVDIFBZCiAgICBpZihwcmVjUFk9PTEpewogICAgICAvL3VzZSAxMS0wMSBhbmQgMTAtMzEgZm9yIHByZXYgZ3JvdyB5cgogICAgICB2YXIgcHJldlllYXIgPSBQWTsKICAgICAgdmFyIHN0YXJ0RGF0ZSA9IFBZLTEgKyctMTEtMDEnOwogICAgICB2YXIgZW5kRGF0ZSA9ICBQWSArICctMTAtMzEnOwogICAgICAvLyBzZWxlY3QgZm9yIHByZWNpcCBkYXRhCiAgICAgIHZhciBwcmVjaXAgPSBncmlkbWV0LnNlbGVjdCgncHInKQogICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkKICAgICAgICAuc3VtKCk7CiAgICAgIC8vIENsaXAgUHJlY2lwIGltYWdlcwogICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgcHJlY2lwX3N1bV9weV9jbGlwcGVkID0gcHJlY2lwLmNsaXAobWFzayk7CiAgICAgIC8vZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgaW1hZ2U6IHByZWNpcF9zdW1fcHlfY2xpcHBlZCwKICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ180a21fZ3JpZG1ldF9wcmVjX3ByZXZZcl8nICsgcHJldlllYXIsCiAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgc2NhbGU6IDEwLAogICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICB9KTsKICAgIH0gLy8gRU5EIFBSRUMgUFkKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gR3Jvd2luZyBEZWdyZWUgRGF5cwogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBHREQgQ1kKICAgIGlmKGdkZENZPT0xKXsKICAgICAgdmFyIGdyb3dfeXIgPSBDWTsKICAgICAgLy91c2UgdGhpcyBibG9jayBmb3IgZ2RkIGZyb20gamFuIDEgdG8gbWFyIDMwIG9mIGN1cnJlbnQgeXIgKGN1cnJlbnQgeWVhcikKICAgICAgdmFyIGdkZF9jeSA9IGdyaWRtZXQgCiAgICAgICAgLmZpbHRlckRhdGUoZ3Jvd195ci50b1N0cmluZygpLCAoZ3Jvd195ciArIDEpLnRvU3RyaW5nKCkpCiAgICAgICAgLmZpbHRlcihlZS5GaWx0ZXIuZGF5T2ZZZWFyKDEsIDkwKSkKICAgICAgICAubWFwKGdkZCkKICAgICAgICAuc3VtKCk7CiAgICAgIC8vIENsaXAgR0REIGltYWdlcwogICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgZ2RkX2N5X2NsaXAgPSAgZ2RkX2N5LmNsaXAobWFzayk7IAogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgIGltYWdlOiBnZGRfY3lfY2xpcCwgLy8KICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ180a21fZ3JpZG1ldF9nZGRfY3VycllyXycgKyBncm93X3lyLCAKICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICBzY2FsZTogMTAsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfSAvLyBFTkQgQ1kgR0RECiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEdERCBQWQogICAgaWYoZ2RkUFk9PTEpewogICAgICB2YXIgZ3Jvd19QcmV2WXIgPSBQWTsKICAgICAgLy8gdXNlIHRoaXMgYmxvY2sgZm9yIGdkZCBmcm9tIGphbiAxIHRocnUganVuIDMwIG9mIHByZXYgZ3JvdyB5ciAocHJldiB5cikKICAgICAgdmFyIGdkZF9weSA9IGdyaWRtZXQKICAgICAgICAuZmlsdGVyRGF0ZShncm93X1ByZXZZci50b1N0cmluZygpLCAoZ3Jvd19QcmV2WXIgKyAxKS50b1N0cmluZygpKQogICAgICAgIC5maWx0ZXIoZWUuRmlsdGVyLmRheU9mWWVhcigxLCAxODApKQogICAgICAgIC5tYXAoZ2RkKQogICAgICAgIC5zdW0oKTsKICAgICAgLy8gQ2xpcCBHREQgaW1hZ2VzCiAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgIHZhciBnZGRfcHlfY2xpcCA9IGdkZF9weS5jbGlwKG1hc2spOyAvLwogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgIGltYWdlOiBnZGRfcHlfY2xpcCwgCiAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfNGttX2dyaWRtZXRfZ2RkX3ByZXZZcl8nICsgZ3Jvd19QcmV2WXIsIAogICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgIHNjYWxlOiAxMCwKICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgfSk7CiAgICB9IC8vIEVORCBQWSBHREQKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVkFSSUFCTEVTIEZST00gRUxFVkFUSU9OIERBVEFTRVRTIChFTEVWLFNMT1BFLEFTUEVDVCxUUEkpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFVTR1MgTkFUSU9OQUwgRUxFVkFUSU9OIERBVEFTRVQKICAgIC8vIGRvd25sb2FkcyBlbGV2YXRpb24gZGF0YSwgY2FsY3VsYXRlcyBzbG9wZSwgYXNwZWN0LCB0cGkgZnJvbSBVU0dTIE5hdGlvbmFsIAogICAgLy8gRWxldmF0aW9uIERhdGFzZXQgKE5FRCk7IAogICAgLy8gQCAxLzMgYXJjLXNlY29uZCByZXNvbHV0aW9uICgxMG0pIGNsaXBwZWQgdG8gZmFybSBib3VuZGFyeSBib3gKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICB2YXIgeWVhciA9IENZOwogICAgLy8gRUxFVkFUSU9OCiAgICBpZihlbGV2PT0xKXsKICAgICAgdmFyIG1hc2sgPSBmYXJtX25hbWU7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgZGVtX2NsaXAgPSBuZWQuY2xpcChtYXNrKTsKICAgICAgLy9leHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICBpbWFnZTogZGVtX2NsaXAsICAvLwogICAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50X2Zhcm0gKyAnX2VsZXZfbmVkXzEwbV8nICsgeWVhciwgLy8gCiAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgIHNjYWxlOiAxMCwKICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICB9KTsKICAgIH0KICAgIC8vIEFTUEVDVF9SQUQKICAgIGlmKGFzcGVjdD09MSl7CiAgICAgIHZhciB0ZXJyYWluID0gZWUuQWxnb3JpdGhtcy5UZXJyYWluKG5lZCk7IC8vIENhbGN1bGF0ZXMgc2xvcGUsIGFzcGVjdCwgYW5kIGEgc2ltcGxlIGhpbGxzaGFkZSBmcm9tIGEgdGVycmFpbiBERU0uCiAgICAgIHZhciBhc3BlY3RfcmFkID0gcmFkaWFucyh0ZXJyYWluLnNlbGVjdCgnYXNwZWN0JykpLmZsb2F0KCk7CiAgICAgIHZhciBtYXNrID0gZmFybV9uYW1lOwogICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgdmFyIGFzcGVjdF9yYWRfY2xpcCA9IGFzcGVjdF9yYWQuY2xpcChtYXNrKTsKICAgICAgLy9leHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICBpbWFnZTogYXNwZWN0X3JhZF9jbGlwLCAgCiAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfYXNwZWN0X3JhZF9uZWRfMTBtXycgKyB5ZWFyLCAKICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgc2NhbGU6IDEwLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfQogICAgLy8gU0xPUEUKICAgIGlmKHNsb3BlST09MSl7CiAgICAgIHZhciB0ZXJyYWluID0gZWUuQWxnb3JpdGhtcy5UZXJyYWluKG5lZCk7IC8vIENhbGN1bGF0ZXMgc2xvcGUsIGFzcGVjdCwgYW5kIGEgc2ltcGxlIGhpbGxzaGFkZSBmcm9tIGEgdGVycmFpbiBERU0uCiAgICAgIHZhciBzbG9wZSA9IHRlcnJhaW4uc2VsZWN0KCdzbG9wZScpLmZsb2F0KCk7CiAgICAgIHZhciBtYXNrID0gZmFybV9uYW1lOwogICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgdmFyIHNsb3BlX2NsaXAgPSBzbG9wZS5jbGlwKG1hc2spOwogICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgIGltYWdlOiBzbG9wZV9jbGlwLCAgLy8KICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19zbG9wZV9uZWRfMTBtXycgKyB5ZWFyLCAvLyAKICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgc2NhbGU6IDEwLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfQogICAgLy8gVFBJIDMwbQogICAgaWYodHBpST09MSl7CiAgICAgIC8vIGNhbGN1bGF0ZSBUUEkKICAgICAgdmFyIHNjYWxlID0gMTA7IC8vIHNjYWxlIGluIG0KICAgICAgdmFyIHRwaV9yYWRpdXMgPSAzKnNjYWxlOyAvLyAzICogMTBtID0gMzBtIHJlcy4KICAgICAgdmFyIHRwaSA9IG5lZC5zdWJ0cmFjdChuZWQuZm9jYWxfbWVhbih0cGlfcmFkaXVzLCAnY2lyY2xlJywgJ21ldGVycycpKS5hZGQoMC41KTsKICAgICAgdmFyIG1hc2sgPSBmYXJtX25hbWU7CiAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICB2YXIgdHBpX2NsaXAgPSB0cGkuY2xpcChtYXNrKTsKICAgICAgLy9leHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICBpbWFnZTogdHBpX2NsaXAsICAvLyAKICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ190cGlfbmVkXzEwbV8nICsgeWVhciwgLy8KICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgc2NhbGU6IDEwLAogICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgIH0pOwogICAgfQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTTUFQIC0gU29pbCBNb2lzdHVyZSBBY3RpdmUgUGFzc2l2ZSAoMjBrbSApCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBpZihzbWFwQ1k9PTEpewogICAgICB2YXIgeWVhciA9IENZOyAvLyAgCiAgICAgIGlmKENZID49IDIwMTYpewogICAgICAgIHZhciBjdXJyWWVhciA9IENZOwogICAgICAgIHZhciBzdGFydERhdGUgPSBQWSArICctMTEtMDEnOwogICAgICAgIHZhciBlbmREYXRlID0gIENZICsgJy0wMy0zMCc7CiAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgIC8vIFNVUkZBQ0UgU09JTCBNT0lTVFVSRSAobW0pIDIwa20gQDQ1TgogICAgICAgIHZhciBzc21DWSA9IHNtYXAuc2VsZWN0KCdzc20nKSAvLy5zZWxlY3QoJ3NzbScpCiAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydERhdGUsIGVuZERhdGUpCiAgICAgICAgICAuZmlsdGVyQm91bmRzKG1hc2tfZ2VvbWV0cnkpCiAgICAgICAgICAubWFwKGZ1bmN0aW9uKGltYWdlKXtyZXR1cm4gaW1hZ2UuY2xpcChtYXNrX2dlb21ldHJ5KX0pIDsKICAgICAgICB2YXIgc3NtQ1kgPSBzc21DWS5yZWR1Y2UoZWUuUmVkdWNlci5tZWRpYW4oKSk7CiAgICAgICAgLy8gU1VCU1VSRkFDRSBTT0lMIE1PSVNUVVJFIChtbSkgMjBrbSBANDVOCiAgICAgICAgdmFyIHN1c21DWSA9IHNtYXAuc2VsZWN0KCdzdXNtJykKICAgICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkKICAgICAgICAgIC5maWx0ZXJCb3VuZHMobWFza19nZW9tZXRyeSkKICAgICAgICAgIC5tYXAoZnVuY3Rpb24oaW1hZ2Upe3JldHVybiBpbWFnZS5jbGlwKG1hc2tfZ2VvbWV0cnkpfSkgOwogICAgICAgIHZhciBzdXNtQ1kgPSBzdXNtQ1kucmVkdWNlKGVlLlJlZHVjZXIubWVkaWFuKCkpOwogICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICBpbWFnZTogc3NtQ1ksCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19zc21fc21hcF8yMGttJyAgKyAnXycgKyB5ZWFyICsgJ19tYXInLAogICAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgICAgc2NhbGU6IDEwLAogICAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICAgIH0pOwogICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgIGltYWdlOiBzdXNtQ1ksCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19zdXNtX3NtYXBfMjBrbScgICsgJ18nICsgeWVhciArICdfbWFyJywKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAxMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgfSAvLyBFTkQgSUYgWUVBUiA+PSAyMDE2CiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICB9IC8vIEVORCBDWSBTTUFQCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGlmKHNtYXBQWT09MSl7CiAgICAgIHZhciB5ZWFyID0gUFk7IC8vICAKICAgICAgaWYoQ1kgPj0gMjAxNil7CiAgICAgICAgdmFyIHByZXZZZWFyID0gUFk7CiAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IFBZLTEgKyctMTEtMDEnOwogICAgICAgIHZhciBlbmREYXRlID0gIFBZICsgJy0xMC0zMSc7CiAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgIC8vIFNVUkZBQ0UgU09JTCBNT0lTVFVSRSAobW0pIDIwa20gQDQ1TgogICAgICAgIHZhciBzc21QWSA9IHNtYXAuc2VsZWN0KCdzc20nKQogICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnREYXRlLCBlbmREYXRlKQogICAgICAgICAgLmZpbHRlckJvdW5kcyhtYXNrX2dlb21ldHJ5KQogICAgICAgICAgLm1hcChmdW5jdGlvbihpbWFnZSl7cmV0dXJuIGltYWdlLmNsaXAobWFza19nZW9tZXRyeSl9KSA7CiAgICAgICAgdmFyIHNzbVBZID0gc3NtUFkucmVkdWNlKGVlLlJlZHVjZXIubWVkaWFuKCkpOwogICAgICAgIC8vIFNVQlNVUkZBQ0UgU09JTCBNT0lTVFVSRSAobW0pIDIwa20gQDQ1TgogICAgICAgIHZhciBzdXNtUFkgPSBzbWFwLnNlbGVjdCgnc3VzbScpCiAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydERhdGUsIGVuZERhdGUpCiAgICAgICAgICAuZmlsdGVyQm91bmRzKG1hc2tfZ2VvbWV0cnkpCiAgICAgICAgICAubWFwKGZ1bmN0aW9uKGltYWdlKXtyZXR1cm4gaW1hZ2UuY2xpcChtYXNrX2dlb21ldHJ5KX0pIDsKICAgICAgICB2YXIgc3VzbVBZID0gc3VzbVBZLnJlZHVjZShlZS5SZWR1Y2VyLm1lZGlhbigpKTsKICAgICAgICAvLyBleHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgICAgaW1hZ2U6IHNzbVBZLAogICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfc3NtX3NtYXBfMjBrbScgICsgJ18nICsgeWVhciwKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAxMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICBpbWFnZTogc3VzbVBZLAogICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfc3VzbV9zbWFwXzIwa20nICArICdfJyArIHllYXIsCiAgICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgICBzY2FsZTogMTAsCiAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgICAgfSk7CiAgICAgIH0gLy8gRU5EIElGIFlFQVIgPj0gMjAxNgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgfSAvLyBFTkQgUFkgU01BUAogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTkRWSSAKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgaWYobmR2aUNZPT0xKXsKICAgICAgdmFyIHllYXIgPSBDWTsgCiAgICAgIHZhciBzdGFydCA9IGVlLkRhdGUoeWVhcisnLTAxLTAxJyk7CiAgICAgIHZhciBlbmQgPSBlZS5EYXRlKHllYXIrJy0wMy0zMCcpOyAvLwogICAgICAvLyBiYXNlZCBvbiB5ZWFyIGRlY2lkZSB3aGF0IGRhdGEgc291cmNlIHRvIHVzZQogICAgICBpZihDWSA+PSAyMDE2KXsKICAgICAgICAvLyBjYWxjdWxhdGVzIG5kdmkgQCAxMG0gcmVzb2x1dGlvbiBmcm9tIFNlbnRpbmVsLTIgCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gU2VudGluZWwgMiAoMTAgbSkKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBzMl9maWx0ZXI6IGZpbHRlcnMgYWxsIGF2YWlsIHNlbnRpbmVsIDIgKHMyKSBpbWFnZXM6IGxpbWl0IHNwYXRpYWwgZXh0ZW50IAogICAgICAgIC8vIHRvIHRoZSBib3VuZGFyeSBhbmQgZmlsdGVyIGRhdGUgcmFuZ2UgYnkgc3RhcnQgYW5kIGVuZCB2YXJzIGRlZmluZWQgYWJvdmUKICAgICAgICB2YXIgczJ0b2FfZmlsdGVyQ1kgPSBzMnRvYQogICAgICAgICAgLmZpbHRlckJvdW5kcyhmYXJtX25hbWUpCiAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydCwgZW5kKQogICAgICAgICAgLy8gUHJlLWZpbHRlciB0byBnZXQgbGVzcyBjbG91ZHkgZ3JhbnVsZXMuCiAgICAgICAgICAuZmlsdGVyKGVlLkZpbHRlci5sdCgnQ0xPVURZX1BJWEVMX1BFUkNFTlRBR0UnLCAyMCkpCiAgICAgICAgICAubWFwKG1hc2tTMmNsb3Vkcyk7CiAgICAgICAgLy8gY29tcHV0ZSBuZHZpIHVzaW5nIHJlZCBiYW5kIDQgYW5kIE5JUiBiYW5kIDhhOyBjYWxjdWxhdGVkIGFzCiAgICAgICAgLy8gOiAoYjgtYjQpLyhiOCtiNCkKICAgICAgICB2YXIgbmR2aVRPQUNZID0gczJ0b2FfZmlsdGVyQ1kubWFwKGZ1bmN0aW9uKGltZyl7CiAgICAgICAgICB2YXIgcmVkID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjQnKSk7CiAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjgnKSk7CiAgICAgICAgICByZXR1cm4gKG5pci5zdWJ0cmFjdChyZWQpKS5kaXZpZGUobmlyLmFkZChyZWQpKS5yZW5hbWUoJ25kdmknKTsKICAgICAgICB9KTsKICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgdmFyIG5kdmlfOTVUT0FDWSA9IG5kdmlUT0FDWS5xdWFsaXR5TW9zYWljKCduZHZpJyk7CiAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgICAgdmFyIG5kdmlfOTVfY2xpcFRPQUNZID0gbmR2aV85NVRPQUNZLmNsaXAobWFzayk7CiAgICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgICAgLy8gZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgIGltYWdlOiBuZHZpXzk1X2NsaXBUT0FDWSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50X2Zhcm0gKyAnX25kdmlfUzJfMTBtJyAgKyAnXycgKyB5ZWFyICsgJ19tYXInLAogICAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgICAgc2NhbGU6IDEwLAogICAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICAgIH0pOwogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIExhbmRzYXQgOCAoMTAgbSkKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAgIHZhciBMOFNSQ1lfZmlsdGVyID0gTDhzcgogICAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgICAgLm1hcChtYXNrTDhzcik7CiAgICAgICAgICB2YXIgbmR2aVNSQ1lMOCA9IEw4U1JDWV9maWx0ZXIubWFwKGZ1bmN0aW9uKGltZyl7CiAgICAgICAgICAgIHZhciByZWQgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNCcpKTsKICAgICAgICAgICAgdmFyIG5pciA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I1JykpOwogICAgICAgICAgICByZXR1cm4gKG5pci5zdWJ0cmFjdChyZWQpKS5kaXZpZGUobmlyLmFkZChyZWQpKS5yZW5hbWUoJ25kdmknKTsKICAgICAgICAgIH0pOwogICAgICAgICAgLy8gTWFrZSBhICJncmVlbmVzdCIgcGl4ZWwgY29tcG9zaXRlLgogICAgICAgICAgdmFyIG5kdmlfOTVTUkNZTDggPSBuZHZpU1JDWUw4LnF1YWxpdHlNb3NhaWMoJ25kdmknKTsKICAgICAgICAgIC8vIGNsaXAgaW1hZ2VzCiAgICAgICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgICAgICB2YXIgbmR2aV85NV9jbGlwU1JDWUw4ID0gbmR2aV85NVNSQ1lMOC5jbGlwKG1hc2spOwogICAgICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgICAgICAvLyBleHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICAgIGltYWdlOiBuZHZpXzk1X2NsaXBTUkNZTDgsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50X2Zhcm0gKyAnX25kdmlfTDhfMzBtJyAgKyAnXycgKyB5ZWFyICsgJ19tYXInLAogICAgICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgICAgIHNjYWxlOiAzMCwKICAgICAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgICAgICB9KTsKICAgICAgfWVsc2V7IC8vIEVORCBJRiBDWSA+PSAyMDE2CiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gTEFORFNBVCA1ICgxOTk5cHkgdG8gMjAxMmN5KQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIGlmKENZIDw9IDIwMTIpeyAKICAgICAgICAgIHZhciBMNVNSQ1lfZmlsdGVyID0gTDVzcgogICAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgICAgLm1hcChjbG91ZE1hc2tMNDU3KTsKICAgICAgICAgIHZhciBuZHZpU1JDWUw1ID0gTDVTUkNZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgICAgdmFyIHJlZCA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0IzJykpOwogICAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjQnKSk7CiAgICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgICB2YXIgbmR2aV85NVNSQ1lMNSA9IG5kdmlTUkNZTDUucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUkNZTDUgPSBuZHZpXzk1U1JDWUw1LmNsaXAobWFzayk7CiAgICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgICAgaW1hZ2U6IG5kdmlfOTVfY2xpcFNSQ1lMNSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmR2aV9MNV8zMG0nICArICdfJyArIHllYXIgKyAnX21hcicsCiAgICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgICAgc2NhbGU6IDMwLAogICAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gRU5EIEw1IElGIENZIDw9MjAxMgogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIExBTkRTQVQgNyAoMjAxMnB5ICYgMjAxM2N5KQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIGlmKENZID09IDIwMTMpeyAKICAgICAgICAgIHZhciBMN1NSQ1lfZmlsdGVyID0gTDdzcgogICAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgICAgLm1hcChjbG91ZE1hc2tMNDU3KTsKICAgICAgICAgIHZhciBuZHZpU1JDWUw3ID0gTDdTUkNZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgICAgdmFyIHJlZCA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0IzJykpOwogICAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjQnKSk7CiAgICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgICB2YXIgbmR2aV85NVNSQ1lMNyA9IG5kdmlTUkNZTDcucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUkNZTDcgPSBuZHZpXzk1U1JDWUw3LmNsaXAobWFzayk7CiAgICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgICAgaW1hZ2U6IG5kdmlfOTVfY2xpcFNSQ1lMNywKICAgICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmR2aV9MN18zMG0nICArICdfJyArIHllYXIgKyAnX21hcicsCiAgICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgICAgc2NhbGU6IDMwLAogICAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gRU5EIEw3IElGIENZID09IDIwMTMKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBMQU5EU0FUIDggKDIwMTNweSAoYXByaWwgLSBkZWMpIHRvIDIwMThjeSBvciAyMDE2cHkpCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgaWYoQ1kgPj0gMjAxNCl7IAogICAgICAgICAgdmFyIEw4U1JDWV9maWx0ZXIgPSBMOHNyCiAgICAgICAgICAgIC5maWx0ZXJCb3VuZHMoZmFybV9uYW1lKQogICAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydCwgZW5kKQogICAgICAgICAgICAubWFwKG1hc2tMOHNyKTsKICAgICAgICAgIHZhciBuZHZpU1JDWUw4ID0gTDhTUkNZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgICAgdmFyIHJlZCA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I0JykpOwogICAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjUnKSk7CiAgICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgICB2YXIgbmR2aV85NVNSQ1lMOCA9IG5kdmlTUkNZTDgucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUkNZTDggPSBuZHZpXzk1U1JDWUw4LmNsaXAobWFzayk7CiAgICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgICAgaW1hZ2U6IG5kdmlfOTVfY2xpcFNSQ1lMOCwKICAgICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmR2aV9MOF8zMG0nICArICdfJyArIHllYXIgKyAnX21hcicsCiAgICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgICAgc2NhbGU6IDMwLAogICAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gRU5EIEw4IElGIENZID49IDIwMTQgQU5EICBDWSA8PSAyMDE3CiAgICAgIH0gLy8gRU5EIElGIE5PVCA+PSAyMDE4IFMyCiAgICB9IC8vIGVuZCBpZiBjdXJyZW50IHllYXIgbmR2aQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFByZXZpb3VzIHllYXIgKGZ1bGwgeWVhcikKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBpZihuZHZpUFk9PTEpewogICAgICB2YXIgeWVhciA9IFBZOyAvLyAgCiAgICAgIHZhciBzdGFydCA9IGVlLkRhdGUoeWVhcisnLTAxLTAxJyk7CiAgICAgIHZhciBlbmQgPSBlZS5EYXRlKHllYXIrJy0xMi0zMScpOyAvLwogICAgICBpZihQWSA+PSAyMDE2KXsKICAgICAgICAvLyBjYWxjdWxhdGVzIG5kdmkgQCAxMG0gcmVzb2x1dGlvbiBmcm9tIFNlbnRpbmVsLTIgCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gU2VudGluZWwgMiAoMTBtKQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIHMyX2ZpbHRlcjogZmlsdGVycyBhbGwgYXZhaWwgc2VudGluZWwgMiAoczIpIGltYWdlczogbGltaXQgc3BhdGlhbCBleHRlbnQgCiAgICAgICAgLy8gdG8gdGhlIGJvdW5kYXJ5IGFuZCBmaWx0ZXIgZGF0ZSByYW5nZSBieSBzdGFydCBhbmQgZW5kIHZhcnMgZGVmaW5lZCBhYm92ZQogICAgICAgIHZhciBzMnRvYV9maWx0ZXJQWSA9IHMydG9hCiAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0LCBlbmQpCiAgICAgICAgICAvLyBQcmUtZmlsdGVyIHRvIGdldCBsZXNzIGNsb3VkeSBncmFudWxlcy4KICAgICAgICAgIC5maWx0ZXIoZWUuRmlsdGVyLmx0KCdDTE9VRFlfUElYRUxfUEVSQ0VOVEFHRScsIDIwKSkKICAgICAgICAgIC5tYXAobWFza1MyY2xvdWRzKTsKICAgICAgICAvLyBjb21wdXRlIG5kdmkgdXNpbmcgcmVkIGJhbmQgNCBhbmQgTklSIGJhbmQgOGE7IGNhbGN1bGF0ZWQgYXMKICAgICAgICAvLyA6IChiOC1iNCkvKGI4K2I0KQogICAgICAgIHZhciBuZHZpVE9BUFkgPSBzMnRvYV9maWx0ZXJQWS5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgIHZhciByZWQgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNCcpKTsKICAgICAgICAgIHZhciBuaXIgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCOCcpKTsKICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgIH0pOwogICAgICAgIC8vIE1ha2UgYSAiZ3JlZW5lc3QiIHBpeGVsIGNvbXBvc2l0ZS4KICAgICAgICB2YXIgbmR2aV85NVRPQVBZID0gbmR2aVRPQVBZLnF1YWxpdHlNb3NhaWMoJ25kdmknKTsKICAgICAgICAvLyBjbGlwIGltYWdlcwogICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICB2YXIgbmR2aV85NV9jbGlwVE9BUFkgPSBuZHZpXzk1VE9BUFkuY2xpcChtYXNrKTsKICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAvL2V4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICBpbWFnZTogbmR2aV85NV9jbGlwVE9BUFksCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19uZHZpX1MyXzEwbScgICsgJ18nICsgeWVhciwKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAxMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBMYW5kc2F0IDggKDMwbSkKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICB2YXIgTDhTUlBZX2ZpbHRlciA9IEw4c3IKICAgICAgICAgIC5maWx0ZXJCb3VuZHMoZmFybV9uYW1lKQogICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgIC5tYXAobWFza0w4c3IpOwogICAgICAgIHZhciBuZHZpU1JQWWZpbHRlckw4ID0gTDhTUlBZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgIHZhciByZWQgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNCcpKTsKICAgICAgICAgIHZhciBuaXIgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNScpKTsKICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgIH0pOwogICAgICAgIC8vIE1ha2UgYSAiZ3JlZW5lc3QiIHBpeGVsIGNvbXBvc2l0ZS4KICAgICAgICB2YXIgbmR2aV85NVNSUFlmaWx0ZXJMOCA9IG5kdmlTUlBZZmlsdGVyTDgucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgIC8vIGNsaXAgaW1hZ2VzCiAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUlBZZmlsdGVyTDggPSBuZHZpXzk1U1JQWWZpbHRlckw4LmNsaXAobWFzayk7CiAgICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgICAgLy8gZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgIGltYWdlOiBuZHZpXzk1X2NsaXBTUlBZZmlsdGVyTDgsCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19uZHZpX0w4XzMwbScgICsgJ18nICsgeWVhciwKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAzMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgfWVsc2V7IC8vIEVORCBTMiBQWSA+PSAyMDE2CiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gTEFORFNBVCA1ICgxOTk5cHkgJiAyMDEyY3kpCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgaWYoUFkgPD0gMjAxMSl7IAogICAgICAgICAgdmFyIEw1U1JQWV9maWx0ZXIgPSBMNXNyCiAgICAgICAgICAgIC5maWx0ZXJCb3VuZHMoZmFybV9uYW1lKQogICAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydCwgZW5kKQogICAgICAgICAgICAubWFwKGNsb3VkTWFza0w0NTcpOwogICAgICAgICAgdmFyIG5kdmlTUlBZZmlsdGVyTDUgPSBMNVNSUFlfZmlsdGVyLm1hcChmdW5jdGlvbihpbWcpewogICAgICAgICAgICB2YXIgcmVkID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjMnKSk7CiAgICAgICAgICAgIHZhciBuaXIgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNCcpKTsKICAgICAgICAgICAgcmV0dXJuIChuaXIuc3VidHJhY3QocmVkKSkuZGl2aWRlKG5pci5hZGQocmVkKSkucmVuYW1lKCduZHZpJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIE1ha2UgYSAiZ3JlZW5lc3QiIHBpeGVsIGNvbXBvc2l0ZS4KICAgICAgICAgIHZhciBuZHZpXzk1U1JQWWZpbHRlckw1ID0gbmR2aVNSUFlmaWx0ZXJMNS5xdWFsaXR5TW9zYWljKCduZHZpJyk7CiAgICAgICAgICAvLyBjbGlwIGltYWdlcwogICAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgICAgdmFyIG5kdmlfOTVfY2xpcFNSUFlmaWx0ZXJMNSA9IG5kdmlfOTVTUlBZZmlsdGVyTDUuY2xpcChtYXNrKTsKICAgICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgICAgLy8gZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgICAgICBpbWFnZTogbmR2aV85NV9jbGlwU1JQWWZpbHRlckw1LAogICAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19uZHZpX0w1XzMwbScgICsgJ18nICsgeWVhciwKICAgICAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgICAgICBzY2FsZTogMzAsCiAgICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyBFTkQgTDUgRk9SIDE5OTkgdG8gMjAxMSBQWQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIExBTkRTQVQgNyAoMjAxMnB5ICYgMjAxM2N5KQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIGlmKFBZID09IDIwMTIpeyAKICAgICAgICAgIHZhciBMN1NSUFlfZmlsdGVyID0gTDdzcgogICAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgICAgLm1hcChjbG91ZE1hc2tMNDU3KTsKICAgICAgICAgIHZhciBuZHZpU1JQWWZpbHRlckw3ID0gTDdTUlBZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgICAgdmFyIHJlZCA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0IzJykpOwogICAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjQnKSk7CiAgICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgICB2YXIgbmR2aV85NVNSUFlmaWx0ZXJMNyA9IG5kdmlTUlBZZmlsdGVyTDcucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUlBZZmlsdGVyTDcgPSBuZHZpXzk1U1JQWWZpbHRlckw3LmNsaXAobWFzayk7CiAgICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgICAgaW1hZ2U6IG5kdmlfOTVfY2xpcFNSUFlmaWx0ZXJMNywKICAgICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmR2aV9MN18zMG0nICArICdfJyArIHllYXIsCiAgICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgICAgc2NhbGU6IDMwLAogICAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gRU5EIEw3IEZPUiAyMDEyIFBZCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gTEFORFNBVCA4ICgyMDEzcHkgKGFwcmlsIC0gZGVjKSB0byAyMDE4Y3kgb3IgMjAxNnB5KQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIGlmKFBZID49IDIwMTMpeyAKICAgICAgICAgIGlmKFBZPT0yMDEzKXsKICAgICAgICAgICAgLy9DSEFOR0UgREFURVMgVE8gQVBSSUwgVE8gREVDCiAgICAgICAgICAgIHZhciBzdGFydDEzID0gZWUuRGF0ZSh5ZWFyKyctMDQtMDEnKTsKICAgICAgICAgICAgdmFyIGVuZDEzID0gZWUuRGF0ZSh5ZWFyKyctMTItMzEnKTsgLy8KICAgICAgICAgICAgdmFyIEw4U1JQWV9maWx0ZXIgPSBMOHNyCiAgICAgICAgICAgICAgLmZpbHRlckJvdW5kcyhmYXJtX25hbWUpCiAgICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQxMywgZW5kMTMpCiAgICAgICAgICAgICAgLm1hcChtYXNrTDhzcik7CiAgICAgICAgICAgIHZhciBuZHZpU1JQWWZpbHRlckw4ID0gTDhTUlBZX2ZpbHRlci5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgICAgICB2YXIgcmVkID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjQnKSk7CiAgICAgICAgICAgICAgdmFyIG5pciA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I1JykpOwogICAgICAgICAgICAgIHJldHVybiAobmlyLnN1YnRyYWN0KHJlZCkpLmRpdmlkZShuaXIuYWRkKHJlZCkpLnJlbmFtZSgnbmR2aScpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gTWFrZSBhICJncmVlbmVzdCIgcGl4ZWwgY29tcG9zaXRlLgogICAgICAgICAgICB2YXIgbmR2aV85NVNSUFlmaWx0ZXJMOCA9IG5kdmlTUlBZZmlsdGVyTDgucXVhbGl0eU1vc2FpYygnbmR2aScpOwogICAgICAgICAgICAvLyBjbGlwIGltYWdlcwogICAgICAgICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgICAgICAgIHZhciBuZHZpXzk1X2NsaXBTUlBZZmlsdGVyTDggPSBuZHZpXzk1U1JQWWZpbHRlckw4LmNsaXAobWFzayk7CiAgICAgICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgICAgICAvLyBleHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgICAgICBpbWFnZTogbmR2aV85NV9jbGlwU1JQWWZpbHRlckw4LAogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50X2Zhcm0gKyAnX25kdmlfTDhfMzBtJyAgKyAnXycgKyB5ZWFyLAogICAgICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgICAgICBzY2FsZTogMzAsCiAgICAgICAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9ZWxzZXsgLy8gZW5kIGlmIFBZID09IDIwMTMKICAgICAgICAgICAgLy8gVVNFIE5PUk1BTCBEQVRFUyAoSkFOIFRPIERFQykKICAgICAgICAgICAgdmFyIEw4U1JQWV9maWx0ZXIgPSBMOHNyCiAgICAgICAgICAgICAgLmZpbHRlckJvdW5kcyhmYXJtX25hbWUpCiAgICAgICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgICAgICAubWFwKG1hc2tMOHNyKTsKICAgICAgICAgICAgdmFyIG5kdmlTUlBZZmlsdGVyTDggPSBMOFNSUFlfZmlsdGVyLm1hcChmdW5jdGlvbihpbWcpewogICAgICAgICAgICAgIHZhciByZWQgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNCcpKTsKICAgICAgICAgICAgICB2YXIgbmlyID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjUnKSk7CiAgICAgICAgICAgICAgcmV0dXJuIChuaXIuc3VidHJhY3QocmVkKSkuZGl2aWRlKG5pci5hZGQocmVkKSkucmVuYW1lKCduZHZpJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgICAgIHZhciBuZHZpXzk1U1JQWWZpbHRlckw4ID0gbmR2aVNSUFlmaWx0ZXJMOC5xdWFsaXR5TW9zYWljKCduZHZpJyk7CiAgICAgICAgICAgIC8vIGNsaXAgaW1hZ2VzCiAgICAgICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICAgICAgdmFyIG5kdmlfOTVfY2xpcFNSUFlmaWx0ZXJMOCA9IG5kdmlfOTVTUlBZZmlsdGVyTDguY2xpcChtYXNrKTsKICAgICAgICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgICAgICAgIGltYWdlOiBuZHZpXzk1X2NsaXBTUlBZZmlsdGVyTDgsCiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmR2aV9MOF8zMG0nICArICdfJyArIHllYXIsCiAgICAgICAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgICAgICAgIHNjYWxlOiAzMCwKICAgICAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gZW5kIGlmIG5vdCBweSA9PSAyMDEzIChhcHIgdG8gZGVjIEw4KQogICAgICAgIH0gLy8gRU5EIEw4IEZPUiAyMDEzIHRvIDIwMTUgUFkKICAgICAgfSAvLyBFTkQgUzIgRUxTRSBQWSA+PSAyMDE2IAogICAgfSAvLyBFTkQgUFkgTkRWSQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBORFJFIAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBpZihuZHJlQ1k9PTEpewogICAgICB2YXIgeWVhciA9IENZOyAKICAgICAgdmFyIHN0YXJ0ID0gZWUuRGF0ZSh5ZWFyKyctMDEtMDEnKTsKICAgICAgdmFyIGVuZCA9IGVlLkRhdGUoeWVhcisnLTAzLTMwJyk7IC8vCiAgICAgIC8vIGJhc2VkIG9uIHllYXIgZGVjaWRlIHdoYXQgZGF0YSBzb3VyY2UgdG8gdXNlCiAgICAgIGlmKENZID49IDIwMTYpewogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIFNlbnRpbmVsIDIgKDEwbSkKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBjYWxjdWxhdGVzIG5kcmUgQCAxMG0gcmVzb2x1dGlvbiBmcm9tIFNlbnRpbmVsLTIgCiAgICAgICAgLy8gczJfZmlsdGVyOiBmaWx0ZXJzIGFsbCBhdmFpbCBzZW50aW5lbCAyIChzMikgaW1hZ2VzOiBsaW1pdCBzcGF0aWFsIGV4dGVudCAKICAgICAgICAvLyB0byB0aGUgYm91bmRhcnkgYW5kIGZpbHRlciBkYXRlIHJhbmdlIGJ5IHN0YXJ0IGFuZCBlbmQgdmFycyBkZWZpbmVkIGFib3ZlCiAgICAgICAgdmFyIHMydG9hX2ZpbHRlckNZID0gczJ0b2EKICAgICAgICAgIC5maWx0ZXJCb3VuZHMoZmFybV9uYW1lKQogICAgICAgICAgLmZpbHRlckRhdGUoc3RhcnQsIGVuZCkKICAgICAgICAgIC8vIFByZS1maWx0ZXIgdG8gZ2V0IGxlc3MgY2xvdWR5IGdyYW51bGVzLgogICAgICAgICAgLmZpbHRlcihlZS5GaWx0ZXIubHQoJ0NMT1VEWV9QSVhFTF9QRVJDRU5UQUdFJywgMjApKQogICAgICAgICAgLm1hcChtYXNrUzJjbG91ZHMpOwogICAgICAgIC8vIGNvbXB1dGUgbmRyZSB1c2luZyByZWQgZWRnZSBiYW5kIDEgYW5kIHJlZCBlZGdlIGJhbmQgMjsgY2FsY3VsYXRlZCBhcwogICAgICAgIC8vIDogKGI2LWI1KS8oYjYrYjUpCiAgICAgICAgdmFyIG5kcmVUT0FDWSA9IHMydG9hX2ZpbHRlckNZLm1hcChmdW5jdGlvbihpbWcpewogICAgICAgICAgdmFyIHJlMSA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I1JykpOwogICAgICAgICAgdmFyIHJlMiA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I2JykpOwogICAgICAgICAgcmV0dXJuIChyZTEuc3VidHJhY3QocmUyKSkuZGl2aWRlKHJlMS5hZGQocmUyKSkucmVuYW1lKCduZHJlJyk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gTWFrZSBhICJncmVlbmVzdCIgcGl4ZWwgY29tcG9zaXRlLgogICAgICAgIHZhciBuZHJlXzk1VE9BQ1kgPSBuZHJlVE9BQ1kucXVhbGl0eU1vc2FpYygnbmRyZScpOwogICAgICAgIC8vIGNsaXAgaW1hZ2VzCiAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgIHZhciBuZHJlXzk1X2NsaXBUT0FDWSA9IG5kcmVfOTVUT0FDWS5jbGlwKG1hc2spOwogICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICBpbWFnZTogbmRyZV85NV9jbGlwVE9BQ1ksCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19uZHJlX1MyXzIwbScgICsgJ18nICsgeWVhciArICdfbWFyJywKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAyMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgfSAvLyBlbmQgaWYgeWVhciA+PSAyMDE4CiAgICB9IC8vIGVuZCBpZiBjdXJyZW50IHllYXIgbmRyZQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFByZXZpb3VzIHllYXIgKGZ1bGwgeWVhcikKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBpZihuZHJlUFk9PTEpewogICAgICB2YXIgeWVhciA9IFBZOyAvLyAgCiAgICAgIHZhciBzdGFydCA9IGVlLkRhdGUoeWVhcisnLTAxLTAxJyk7CiAgICAgIHZhciBlbmQgPSBlZS5EYXRlKHllYXIrJy0xMi0zMScpOyAvLwogICAgICBpZihQWSA+PSAyMDE2KXsKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBTZW50aW5lbCAyICgxMG0pCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gY2FsY3VsYXRlcyBuZHJlIEAgMTBtIHJlc29sdXRpb24gZnJvbSBTZW50aW5lbC0yIAogICAgICAgIC8vIHMyX2ZpbHRlcjogZmlsdGVycyBhbGwgYXZhaWwgc2VudGluZWwgMiAoczIpIGltYWdlczogbGltaXQgc3BhdGlhbCBleHRlbnQgCiAgICAgICAgLy8gdG8gdGhlIGJvdW5kYXJ5IGFuZCBmaWx0ZXIgZGF0ZSByYW5nZSBieSBzdGFydCBhbmQgZW5kIHZhcnMgZGVmaW5lZCBhYm92ZQogICAgICAgIC8vLy8vIFBZIFRPQSBTMiB3L2ZpbHRlciAvLy8vLwogICAgICAgIHZhciBzMnRvYV9maWx0ZXJQWSA9IHMydG9hCiAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0LCBlbmQpCiAgICAgICAgICAvLyBQcmUtZmlsdGVyIHRvIGdldCBsZXNzIGNsb3VkeSBncmFudWxlcy4KICAgICAgICAgIC5maWx0ZXIoZWUuRmlsdGVyLmx0KCdDTE9VRFlfUElYRUxfUEVSQ0VOVEFHRScsIDIwKSkKICAgICAgICAgIC5tYXAobWFza1MyY2xvdWRzKTsKICAgICAgICAvLyBjb21wdXRlIG5kcmUgdXNpbmcgcmVkIGJhbmQgNCBhbmQgTklSIGJhbmQgOGE7IGNhbGN1bGF0ZWQgYXMKICAgICAgICAvLyA6IChiOC1iNCkvKGI4K2I0KQogICAgICAgIHZhciBuZHJlVE9BUFkgPSBzMnRvYV9maWx0ZXJQWS5tYXAoZnVuY3Rpb24oaW1nKXsKICAgICAgICAgIHZhciByZTEgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNScpKTsKICAgICAgICAgIHZhciByZTIgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNicpKTsKICAgICAgICAgIHJldHVybiAocmUxLnN1YnRyYWN0KHJlMikpLmRpdmlkZShyZTEuYWRkKHJlMikpLnJlbmFtZSgnbmRyZScpOwogICAgICAgIH0pOwogICAgICAgIC8vIE1ha2UgYSAiZ3JlZW5lc3QiIHBpeGVsIGNvbXBvc2l0ZS4KICAgICAgICB2YXIgbmRyZV85NVRPQVBZID0gbmRyZVRPQVBZLnF1YWxpdHlNb3NhaWMoJ25kcmUnKTsKICAgICAgICAvLyBjbGlwIGltYWdlcwogICAgICAgIHZhciBtYXNrID0gZWUuRmVhdHVyZUNvbGxlY3Rpb24oZmFybV9uYW1lKTsKICAgICAgICB2YXIgbmRyZV85NV9jbGlwVE9BUFkgPSBuZHJlXzk1VE9BUFkuY2xpcChtYXNrKTsKICAgICAgICB2YXIgbWFza19nZW9tZXRyeSA9IG1hc2suZ2VvbWV0cnkoKS5ib3VuZHMoKTsKICAgICAgICAvLyBleHBvcnQgdG8gZ29vZ2xlIGRyaXZlCiAgICAgICAgRXhwb3J0LmltYWdlLnRvRHJpdmUoewogICAgICAgICAgaW1hZ2U6IG5kcmVfOTVfY2xpcFRPQVBZLAogICAgICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnRfZmFybSArICdfbmRyZV9TMl8yMG0nICArICdfJyArIHllYXIsCiAgICAgICAgICBmb2xkZXI6J0dFRV9TdXJmYWNlcycsCiAgICAgICAgICBzY2FsZTogMjAsCiAgICAgICAgICBjcnM6ICdFUFNHOjQzMjYnLAogICAgICAgICAgcmVnaW9uOiBtYXNrX2dlb21ldHJ5CiAgICAgICAgfSk7CiAgICAgIH0gLy8gZW5kIGlmIHB5ID49IDIwMTYKICAgIH0gLy8gISEhIEVORCBQWSBORFJFICEhISAgCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENJUkUgCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGlmKGNscmVDWT09MSl7CiAgICAgIHZhciB5ZWFyID0gQ1k7IAogICAgICB2YXIgc3RhcnQgPSBlZS5EYXRlKHllYXIrJy0wMS0wMScpOwogICAgICB2YXIgZW5kID0gZWUuRGF0ZSh5ZWFyKyctMDMtMzAnKTsgLy8KICAgICAgLy8gYmFzZWQgb24geWVhciBkZWNpZGUgd2hhdCBkYXRhIHNvdXJjZSB0byB1c2UKICAgICAgaWYoQ1kgPj0gMjAxNil7CiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gU2VudGluZWwgMiAoMTBtKQogICAgICAgIC8vQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAogICAgICAgIC8vIGNhbGN1bGF0ZXMgY2xyZSBAIDEwbSByZXNvbHV0aW9uIGZyb20gU2VudGluZWwtMiAKICAgICAgICAvLyBzMl9maWx0ZXI6IGZpbHRlcnMgYWxsIGF2YWlsIHNlbnRpbmVsIDIgKHMyKSBpbWFnZXM6IGxpbWl0IHNwYXRpYWwgZXh0ZW50IAogICAgICAgIC8vIHRvIHRoZSBib3VuZGFyeSBhbmQgZmlsdGVyIGRhdGUgcmFuZ2UgYnkgc3RhcnQgYW5kIGVuZCB2YXJzIGRlZmluZWQgYWJvdmUKICAgICAgICB2YXIgczJ0b2FfZmlsdGVyQ1kgPSBzMnRvYQogICAgICAgICAgLmZpbHRlckJvdW5kcyhmYXJtX25hbWUpCiAgICAgICAgICAuZmlsdGVyRGF0ZShzdGFydCwgZW5kKQogICAgICAgICAgLy8gUHJlLWZpbHRlciB0byBnZXQgbGVzcyBjbG91ZHkgZ3JhbnVsZXMuCiAgICAgICAgICAuZmlsdGVyKGVlLkZpbHRlci5sdCgnQ0xPVURZX1BJWEVMX1BFUkNFTlRBR0UnLCAyMCkpCiAgICAgICAgICAubWFwKG1hc2tTMmNsb3Vkcyk7CiAgICAgICAgLy8gY2FsY3VsYXRlIGNobG9yb3BoeWxsIHJlZCBlZGdlIGluZGV4IHVzaW5nIGJhbmRzIDcgYW5kIDU7IGZvcm11bGEgZnJvbSAKICAgICAgICAvLyBjbGV2ZXJzIGFuZCBnaXRsZXNvbiAyMDEyOiAoYjcgLyBiNSkgLSAxCiAgICAgICAgdmFyIGNscmVUT0FDWSA9IHMydG9hX2ZpbHRlckNZLm1hcChmdW5jdGlvbihpbWcpewogICAgICAgICAgdmFyIGI3ID0gZWUuSW1hZ2UoaW1nLnNlbGVjdCgnQjcnKSk7CiAgICAgICAgICB2YXIgYjUgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNScpKTsKICAgICAgICAgIHJldHVybiAoYjcuZGl2aWRlKGI1KSkuc3VidHJhY3QoMSkucmVuYW1lKCdjbHJlJyk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gTWFrZSBhICJncmVlbmVzdCIgcGl4ZWwgY29tcG9zaXRlLgogICAgICAgIHZhciBjbHJlXzk1VE9BQ1kgPSBjbHJlVE9BQ1kucXVhbGl0eU1vc2FpYygnY2xyZScpOwogICAgICAgIC8vIGNsaXAgaW1hZ2VzCiAgICAgICAgdmFyIG1hc2sgPSBlZS5GZWF0dXJlQ29sbGVjdGlvbihmYXJtX25hbWUpOwogICAgICAgIHZhciBjbHJlXzk1X2NsaXBUT0FDWSA9IGNscmVfOTVUT0FDWS5jbGlwKG1hc2spOwogICAgICAgIHZhciBtYXNrX2dlb21ldHJ5ID0gbWFzay5nZW9tZXRyeSgpLmJvdW5kcygpOwogICAgICAgIC8vIGV4cG9ydCB0byBnb29nbGUgZHJpdmUKICAgICAgICBFeHBvcnQuaW1hZ2UudG9Ecml2ZSh7CiAgICAgICAgICBpbWFnZTogY2xyZV85NV9jbGlwVE9BQ1ksCiAgICAgICAgICBkZXNjcmlwdGlvbjogY3VycmVudF9mYXJtICsgJ19jbHJlX1MyXzIwbScgICsgJ18nICsgeWVhciArICdfbWFyJywKICAgICAgICAgIGZvbGRlcjonR0VFX1N1cmZhY2VzJywKICAgICAgICAgIHNjYWxlOiAyMCwKICAgICAgICAgIGNyczogJ0VQU0c6NDMyNicsCiAgICAgICAgICByZWdpb246IG1hc2tfZ2VvbWV0cnkKICAgICAgICB9KTsKICAgICAgfSAvLyBlbmQgaWYgeWVhciA+PSAyMDE2CiAgICB9IC8vIGVuZCBpZiBjdXJyZW50IHllYXIgY2xyZQogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFByZXZpb3VzIHllYXIgKGZ1bGwgeWVhcikKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBpZihjbHJlUFk9PTEpewogICAgICB2YXIgeWVhciA9IFBZOyAvLyAgCiAgICAgIHZhciBzdGFydCA9IGVlLkRhdGUoeWVhcisnLTAxLTAxJyk7CiAgICAgIHZhciBlbmQgPSBlZS5EYXRlKHllYXIrJy0xMi0zMScpOyAvLwogICAgICBpZihQWSA+PSAyMDE2KXsKICAgICAgICAvL0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAKICAgICAgICAvLyBTZW50aW5lbCAyICgxMG0pCiAgICAgICAgLy9AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBACiAgICAgICAgLy8gY2FsY3VsYXRlcyBjbHJlIEAgMTBtIHJlc29sdXRpb24gZnJvbSBTZW50aW5lbC0yIAogICAgICAgIC8vIHMyX2ZpbHRlcjogZmlsdGVycyBhbGwgYXZhaWwgc2VudGluZWwgMiAoczIpIGltYWdlczogbGltaXQgc3BhdGlhbCBleHRlbnQgCiAgICAgICAgLy8gdG8gdGhlIGJvdW5kYXJ5IGFuZCBmaWx0ZXIgZGF0ZSByYW5nZSBieSBzdGFydCBhbmQgZW5kIHZhcnMgZGVmaW5lZCBhYm92ZQogICAgICAgIHZhciBzMnRvYV9maWx0ZXJQWSA9IHMydG9hCiAgICAgICAgICAuZmlsdGVyQm91bmRzKGZhcm1fbmFtZSkKICAgICAgICAgIC5maWx0ZXJEYXRlKHN0YXJ0LCBlbmQpCiAgICAgICAgICAvLyBQcmUtZmlsdGVyIHRvIGdldCBsZXNzIGNsb3VkeSBncmFudWxlcy4KICAgICAgICAgIC5maWx0ZXIoZWUuRmlsdGVyLmx0KCdDTE9VRFlfUElYRUxfUEVSQ0VOVEFHRScsIDIwKSkKICAgICAgICAgIC5tYXAobWFza1MyY2xvdWRzKTsKICAgICAgICAvLyBjYWxjdWxhdGUgY2hsb3JvcGh5bGwgcmVkIGVkZ2UgaW5kZXggdXNpbmcgYmFuZHMgNyBhbmQgNTsgZm9ybXVsYSBmcm9tIAogICAgICAgIC8vIGNsZXZlcnMgYW5kIGdpdGxlc29uIDIwMTI6IChiNyAvIGI1KSAtIDEKICAgICAgICB2YXIgY2xyZVRPQVBZID0gczJ0b2FfZmlsdGVyUFkubWFwKGZ1bmN0aW9uKGltZyl7CiAgICAgICAgICB2YXIgYjcgPSBlZS5JbWFnZShpbWcuc2VsZWN0KCdCNycpKTsKICAgICAgICAgIHZhciBiNSA9IGVlLkltYWdlKGltZy5zZWxlY3QoJ0I1JykpOwogICAgICAgICAgcmV0dXJuIChiNy5kaXZpZGUoYjUpKS5zdWJ0cmFjdCgxKS5yZW5hbWUoJ2NscmUnKTsKICAgICAgICB9KTsKICAgICAgICAvLyBNYWtlIGEgImdyZWVuZXN0IiBwaXhlbCBjb21wb3NpdGUuCiAgICAgICAgdmFyIGNscmVfOTVUT0FQWSA9IGNscmVUT0FQWS5xdWFsaXR5TW9zYWljKCdjbHJlJyk7CiAgICAgICAgLy8gY2xpcCBpbWFnZXMKICAgICAgICB2YXIgbWFzayA9IGVlLkZlYXR1cmVDb2xsZWN0aW9uKGZhcm1fbmFtZSk7CiAgICAgICAgdmFyIGNscmVfOTVfY2xpcFRPQVBZID0gY2xyZV85NVRPQVBZLmNsaXAobWFzayk7CiAgICAgICAgdmFyIG1hc2tfZ2VvbWV0cnkgPSBtYXNrLmdlb21ldHJ5KCkuYm91bmRzKCk7CiAgICAgICAgLy8gZXhwb3J0IHRvIGdvb2dsZSBkcml2ZQogICAgICAgIEV4cG9ydC5pbWFnZS50b0RyaXZlKHsKICAgICAgICAgIGltYWdlOiBjbHJlXzk1X2NsaXBUT0FQWSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBjdXJyZW50X2Zhcm0gKyAnX2NscmVfUzJfMjBtJyAgKyAnXycgKyB5ZWFyLAogICAgICAgICAgZm9sZGVyOidHRUVfU3VyZmFjZXMnLAogICAgICAgICAgc2NhbGU6IDIwLAogICAgICAgICAgY3JzOiAnRVBTRzo0MzI2JywKICAgICAgICAgIHJlZ2lvbjogbWFza19nZW9tZXRyeQogICAgICAgIH0pOwogICAgICB9IC8vIGVuZCBpZiBweSA+PSAyMDE2CiAgICB9IC8vIEVORCBQWSBDSVJFCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyBFTkQgRkFSTVMgTE9PUAogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIH0KICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLy8gRU5EIFlFQVJTIExPT1AKICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCn0KCgoKCgoKCg==" download="OFPE GEE Code">Download OFPE GEE Code</a>
<div class="figure">
<img src="run_gee/step_cre_1.png" alt="" />
<p class="caption">First few lines of the GEE OFPE code. This view is of TextEdit on a Mac.</p>
</div>
</div>
<div id="script-editingexecution" class="section level3">
<h3>Script Editing/Execution</h3>
<p>This section of the tutorial is for editing the OFPE script and executing it on an annual basis to collect relevant Google Earth Engine data. It can also be ran as often as required for any specified data.</p>
<p><strong>1.</strong></p>
<p><img src="run_gee/step_upd_1.png" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
